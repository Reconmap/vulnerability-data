#!/usr/bin/env python3

import sys, json, logging
import numpy as np

logFormatter = logging.Formatter("%(asctime)s [%(threadName)-12.12s] [%(levelname)-5.5s]  %(message)s")
consoleHandler = logging.StreamHandler()
consoleHandler.setFormatter(logFormatter)

rootLogger = logging.getLogger()
rootLogger.addHandler(consoleHandler)

years = sys.argv[1].split(',')

newlist = []
for year in years:
    year = int(year)
    logging.info("processing year %d" % year)
    filepath = 'nvdcve-1.1-%d.json' % year
    fd = open(filepath)
    file = json.load(fd)
    fd.close()
    items = file['CVE_Items']
    for item in items:
        cve = item["cve"]
        cc = {
            "id": cve["CVE_data_meta"]["ID"],
            "published_date": item["publishedDate"],
            "last_modified_date": item["lastModifiedDate"],
            "assigner": cve["CVE_data_meta"]["ASSIGNER"],
            "description": cve["description"]["description_data"][0]["value"],
            "references": cve["references"]["reference_data"],
            "impact": item["impact"],
        }
        try:
            cc["problem_type"] = cve["problemtype"]["problemtype_data"][0]["description"][0]["value"]
        except:
            pass
        newlist.append(cc)

json.dump(newlist, open('collection-cves.json', 'w'))
