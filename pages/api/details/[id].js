import clientPromise from "../../../services/database";

export default async function handler(req, res) {
  if (req.method === "GET") {
    try {
      const conn = await clientPromise;
      const db = conn.db("vd-db");
      const cve = await db.collection("cves").findOne({ id: req.query.id });
      if (cve) {
        delete cve._id;

        return res.status(200).json(cve);
      }

      return res.status(404).json({ message: "CVE not found" });
    } catch (error) {
      console.error(error);
      return res.status(500).json({ message: "Internal error" });
    }
  }
  return res.status(403).json({ message: "Not allowed" });
}
