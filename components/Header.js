import Link from "next/link";
import { useRouter } from "next/router";
import React, { useState } from "react";

const Header = ({ years }) => {
  const router = useRouter();
  const [searching, setSearching] = useState(false);
  const [query, setQuery] = useState();

  const handleSetQuery = (e) => setQuery(e.target.value);

  const handleSearch = (e) => {
    e.preventDefault();
    setSearching(true);
    let year;
    let id;
    if (query.split("-").length === 2) {
      // if doesnt include "CVE|cve"
      year = query.split("-")[0];
      id = query.split("-")[1];
    } else {
      year = query.split("-")[1];
      id = query.split("-")[2];
    }
    router.push(`/${year}/CVE-${year}-${id}`);
    setSearching(false);
  };

  return (
    <div className="navbar mb-2 shadow-lg bg-neutral text-neutral-content ">
      <div className="flex-none px-2 mx-2">
        <Link href={`/`} passHref>
          <a>
            <h1 className="text-lg font-bold">Vulnerability Data</h1>
          </a>
        </Link>
      </div>
      <div className="flex-1 px-2 mx-2">
        <div className="items-stretch hidden lg:flex">
          {years.map((year) => (
            <Link href={`/${year}`} passHref key={year}>
              <a className={`btn btn-ghost   ${router.asPath.split("/")[1].includes(year) ? "bg-neutral-focus" : ""} `}>{year}</a>
            </Link>
          ))}
        </div>
      </div>
      <div>
        {searching && (
          <span className="px-3 opacity-50">
            <svg className="w-6 h-6 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
          </span>
        )}
        <form onSubmit={handleSearch}>
          <input
            pattern="((CVE|cve)-)?\d{4}-\d{4,7}"
            placeholder="eg. CVE-2022-0001"
            className={`input input-bordered input-ghost `}
            type="text"
            name="Vulnerability"
            required
            title="eg. CVE-2022-0001 or 2019-3032"
            aria-label="CVE - year - [4-7]-digits id"
            onChange={handleSetQuery}
          ></input>
        </form>
      </div>
    </div>
  );
};

export default Header;
